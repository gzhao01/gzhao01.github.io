<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="kvAOpjBj3WdYhThIJzQsebX7Q4YpH1ORgg1rVtA-cqk"/>
  <meta name="baidu-site-verification" content="AMXRSnG920"/>

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.gzhao01.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="toon water shader in unity">
<meta property="og:type" content="article">
<meta property="og:title" content="toonWaterShader">
<meta property="og:url" content="https://www.gzhao01.top/toonWaterShader/index.html">
<meta property="og:site_name" content="gzhao01&#39;s blog">
<meta property="og:description" content="toon water shader in unity">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.gzhao01.top/toonWaterShader/4yjn47det4y51.jpg">
<meta property="og:image" content="https://www.gzhao01.top/toonWaterShader/3iapic2gt4y51.jpg">
<meta property="article:published_time" content="2021-06-05T08:33:00.000Z">
<meta property="article:modified_time" content="2021-06-07T02:14:20.391Z">
<meta property="article:author" content="gzhao01">
<meta property="article:tag" content="computer graphics">
<meta property="article:tag" content="unity">
<meta property="article:tag" content="shader">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.gzhao01.top/toonWaterShader/4yjn47det4y51.jpg">

<link rel="canonical" href="https://www.gzhao01.top/toonWaterShader/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>toonWaterShader | gzhao01's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">gzhao01's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">62</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">21</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">106</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/gzhao01" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.gzhao01.top/toonWaterShader/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/smileMan.jpg">
      <meta itemprop="name" content="gzhao01">
      <meta itemprop="description" content="interested in coding, gaming and animation">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gzhao01's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          toonWaterShader
        </h1>

        <div class="post-meta">

	  
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-05 16:33:00" itemprop="dateCreated datePublished" datetime="2021-06-05T16:33:00+08:00">2021-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-06-07 10:14:20" itemprop="dateModified" datetime="2021-06-07T10:14:20+08:00">2021-06-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index"><span itemprop="name">unity</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/toonWaterShader/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/toonWaterShader/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>15k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>13 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>toon water shader in unity</p>
<a id="more"></a>

<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>水面的shader</p>
<p><a href="https://roystan.net/articles/toon-water.html" target="_blank" rel="noopener">https://roystan.net/articles/toon-water.html</a></p>
<p>水波的shader</p>
<p><a href="https://www.patreon.com/posts/24192529" target="_blank" rel="noopener">https://www.patreon.com/posts/24192529</a></p>
<h1 id="水面shader"><a href="#水面shader" class="headerlink" title="水面shader"></a>水面shader</h1><p>水面shader的核心是计算cameraDepth和sceneDepth之差，即cameraDepth-sceneDepth。</p>
<p>cameraDepth可以获得透明物体的深度值。</p>
<p>sceneDepth可以无视透明物体，可以通过screenPosition.w来获得。</p>
<p>其中cameraDepth可以通过一个赋给相机的脚本生成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[SerializeField]</span><br><span class="line">DepthTextureMode depthTextureMode;</span><br><span class="line"></span><br><span class="line">private void OnValidate()</span><br><span class="line">&#123;</span><br><span class="line">    SetCameraDepthTextureMode();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void Awake()</span><br><span class="line">&#123;</span><br><span class="line">    SetCameraDepthTextureMode();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void SetCameraDepthTextureMode()</span><br><span class="line">&#123;</span><br><span class="line">    GetComponent&lt;Camera&gt;().depthTextureMode &#x3D; depthTextureMode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样子就可以通过_CameraDepthTexture得到该值</p>
<h3 id="cameraDepthTexture的解释"><a href="#cameraDepthTexture的解释" class="headerlink" title="cameraDepthTexture的解释"></a>cameraDepthTexture的解释</h3><p>cameraDepthTexture就是对<strong>整个场景</strong>而不是shader依附的物体，进行采样</p>
<p><strong>与shader里的screenPositon.w不同的是</strong>，shader里的screenPosition.w只能获取shader依附表面的depth。</p>
<h3 id="SceneDepth（CameraDepthTexture）的解释"><a href="#SceneDepth（CameraDepthTexture）的解释" class="headerlink" title="SceneDepth（CameraDepthTexture）的解释"></a>SceneDepth（CameraDepthTexture）的解释</h3><p><a href="https://www.reddit.com/r/Unity3D/comments/jqpvx4/an_explanation_of_the_scene_depth_node/" target="_blank" rel="noopener">https://www.reddit.com/r/Unity3D/comments/jqpvx4/an_explanation_of_the_scene_depth_node/</a></p>
<img src="/toonWaterShader/4yjn47det4y51.jpg" class="" title="img">

<img src="/toonWaterShader/3iapic2gt4y51.jpg" class="" title="img">

<p>这里的解释是</p>
<blockquote>
<p>The Scene Depth node returns a value between 0 and 1, this value corresponds to the distance between the camera and an opaque object.</p>
<p>For every pixel of the object that has a shader containing the Scene Depth node, you can imagine a line going from the camera straight to that pixel and continuing forward until the camera’s depth buffer, if in this line’s path lies an opaque object, then the Scene Depth node returns a value equal to the distance from the camera to that object divided by the camera’s depth buffer. However, if that imaginary line doesn’t find any opaque objects, then it will return 1.</p>
<p>For example, if the camera’s depth buffer is 1000 units and you have an box opaque box 500 units away, then the Scene Depth node of <strong>any transparent object between the camera and the box will return 0.5</strong> for every pixel that “covers” the box and 1 for the rest of the pixels.</p>
</blockquote>
<h3 id="screenPosition-w的解释"><a href="#screenPosition-w的解释" class="headerlink" title="screenPosition.w的解释"></a>screenPosition.w的解释</h3><h5 id="解释一："><a href="#解释一：" class="headerlink" title="解释一："></a>解释一：</h5><p><a href="https://forum.unity.com/threads/what-does-screenposition-a-means-in-shader-graph.909866/" target="_blank" rel="noopener">https://forum.unity.com/threads/what-does-screenposition-a-means-in-shader-graph.909866/</a></p>
<p>大意就是，perspective下，z/w就是对depth buffer的插值</p>
<p>orthographic下，w恒为1</p>
<p>个人觉得类似于GAMES101的作业三里面的depth buffer插值操作</p>
<blockquote>
<p> However in the “raw” mode this is passing along the original interpolated clip space position z and w. The z/w (or rather b/a in shader graph) is the raw depth buffer value for that pixel, similar to the raw value you’d get from the Scene Depth node. The w or a depends on if you’re using a perspective or orthographic camera. With an orthographic projection the w is always 1.0. With a perspective camera it’s the view depth, equivalent to the Position node’s negative b if set to Space View (view space is -Z forward).</p>
</blockquote>
<blockquote>
<p> Why is that the value for a? Because of how perspective correct interpolation works. The Screen Position node’s rg values in the default mode are equal to rg/a in the raw mode. That’s actually how the default mode calculates those values from the interpolated inputs. When using an orthographic projection you don’t need to do any special handling of interpolated values, so the a is just always 1.0. As I said before, b/a is the depth, because the zw values are copies of the unmodified clip space position the vertex shader outputs and that the GPU normally uses to calculate the screen depth by doing that same z/w in the hardware.  </p>
</blockquote>
<h5 id="解释二："><a href="#解释二：" class="headerlink" title="解释二："></a>解释二：</h5><blockquote>
<p>  LinearEyeDepth takes the depth from the non-linear depth buffer and converts it to linear eye depth, which is roughly identical to the clip space w in precision. It’s also the same value you get from the COMPUTE_EYEDEPTH macro when in the vertex function, though that’s calculated by applying the world and view matrices to the object space vertex position.</p>
<p>So why all of the different versions of this?</p>
<p>When using anything but the usual projection matrix, w component of the clip space position is not the view/eye depth. In fact when it’s an orthographic camera it’s a constant value. So if you need the linear depth for something and want to make sure your shader supports all projection matrix types, you can’t rely on the w being the depth. Plus, you often want to know the depth of a vertex in the fragment shader prior to calculating the clip space position. So that’s where COMPUTE_EYEDEPTH comes in.</p>
<p>What about LinearEyeDepth? That’s taking the value from the non-linear depth buffer and converting it into linear depth as I mentioned above. This is often the depth from the camera depth texture rather than some value interpolated from the current shader’s vertex stage. But you could get it the depth buffer value for a mesh from the input.pos.z value in the above shader, as that”s what that value holds in the fragment shader. But that’s extra math, including a divide that can be costly on some hardware. So it’s often better passed separately. Plus the conversion from non-linear depth buffer to linear depth buffer is actually broken in Unity if you’re using something other than a default perspective projection matrix since that function assumes some stuff (mainly that you are using a default projection matrix) so it can simplify the math.</p>
<p>But wait, I said you can access the input.pos, which is the same as the output.pos from the vertex function, which means the input.pos.w holds the linear depth! Right? Nope. Even assuming a perspective matrix this isn’t the case. The value you output from the vertex function is in clip space, but that same variable input into the fragment shader has been transformed into window space by the GPU. The x and y are now the screen pixel position, z is the non-linear depth buffer (which has a 0.0 to 1.0 range for all graphics APIs, remember I said clip space is 0.0 to w on some, and -w to w on otheres), and the w is 1.0. Yes, just 1.0, always. That’s because it’s the w component after the GPU applied the perspective divide, which is dividing the whole float4 value by the w, and any non zero number divided by itself is 1.0.</p>
<p>Now let’s look at why specifically the ComputeScreenPos passes the w value. This is so it can apply the perspective divide to the interpolated position. When using a non-orthographic projection, a screen space interpolated float3 position won’t interpolate the way you’d expect in 3D space. You’ll get odd warping and stretching of the value between the vertices as they’re being interpolated linearly in 2D screen space, not in 3D view space. Remember all that weird texture warping from old PS1 games? It’s that. Using a perspective divide let’s you interpolate a float4 value and correct the “2D” linear interpolation to take into account the perspective making they work as you would expect them to. So really that’s all it’s there for.</p>
<p>So, the shader example above is making use of the w component as an optimization, by assuming the use of a perspective matrix, they know that value used to correct for perspective interpolation is also the view depth.  </p>
</blockquote>
<h5 id="解释三："><a href="#解释三：" class="headerlink" title="解释三："></a>解释三：</h5><p><a href="https://gamedev.stackexchange.com/questions/186226/understanding-screen-position-node-in-unity-shader-graph" target="_blank" rel="noopener">https://gamedev.stackexchange.com/questions/186226/understanding-screen-position-node-in-unity-shader-graph</a></p>
<blockquote>
<p>It sounds like when the Screen Position mode is <strong>in the “Raw” mode</strong> as used in the tutorial you linked, it’s giving you the same result as you’d get from this shader…</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> v2f &#123;</span><br><span class="line">    float4 vertex : SV_POSITION;</span><br><span class="line">    float4 screenPosition : TEXCOORD0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">v2f <span class="title">vert</span> (<span class="params">appdata v</span>)</span> &#123;</span><br><span class="line">    v2f o;</span><br><span class="line">    <span class="comment">// This is effectively a multiplication by the Model-View-Projection matrix,</span></span><br><span class="line">    <span class="comment">// taking the vertex from object space to clip space (before the perspective divide)</span></span><br><span class="line">    o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// This copies the information from the "special" vertex position semantic that in</span></span><br><span class="line">    <span class="comment">// older shader models we can't read directly in the fragment shader. Copying it out</span></span><br><span class="line">    <span class="comment">// lets us interpolate it and read it just like any other texture coordinate.</span></span><br><span class="line">    o.screenPosition = o.vertex;</span><br><span class="line">    <span class="keyword">return</span> o;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">fixed4 <span class="title">frag</span> (<span class="params">v2f i</span>) : SV_Target</span> &#123;</span><br><span class="line">    <span class="comment">// Here we get the per-pixel value, after it's been</span></span><br><span class="line">    <span class="comment">// interpolated between the three vertices in the triangle.</span></span><br><span class="line">    float4 shift = i.screenPosition;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Ordinarily, 0,0 would be the center of the screen, but Unity calls </span></span><br><span class="line">    <span class="comment">// that mode "Center" not "Raw". In Raw mode, the center of the screen is 0.5</span></span><br><span class="line">    shift.xy += <span class="number">0.5f</span>;</span><br><span class="line">    <span class="keyword">return</span> shift;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this <code>screenPosition</code> value, the 4th component of the vector, “<strong>w</strong>“ (or “Alpha / a” when you think of the vector as an RGBA colour), is the easiest to understand: <strong>it’s the world-space depth</strong> of the pixel being drawn, measured from the camera, along its viewing axis. (Also called <strong>eye-space depth</strong>)</p>
<p>The x, y, and z components have been mangled by the projection in a way that makes them a bit more complicated to explain, so I’ll attack them separately:</p>
<p>If we do “the perspective divide” on <strong>x and y</strong>, dividing them by the depth w, this brings them into normalized device coordinates, telling us <strong>where the pixel sits within our rendering viewport</strong>. x/w = -1 is the left edge, x/w = 0 is the center, and x/w = 1 is the right edge. Likewise for y/w along the vertical. The further away a point is in depth, the more it gets crunched-in by this perspective divide, creating the effect where objects appear smaller as they move further away.</p>
<p>The values before the division are related to the eye-space position of the point, scaled according to the horizontal and vertical field of view, and occasionally shifted if we’re using an oblique frustum. Suffice it to say, they’re “whatever we need them to be so that the perspective divide puts them into the right place on the screen” - it’s usually not very meaningful to operate on these values before the division.</p>
<p>Note that in the Unity Shader graph node these x and y values have been shifted to keep (0.5, 0.5) at the center of the screen, presumably so that if you’re using this to map a texture in screen space, it stays centered by default.</p>
<p><strong>The z component</strong> has a different mangling applied, to handle <strong>clipping against the near and far planes</strong>, at z = -1 and z = 1 respectively. Values between these extremes are non-linearly distributed, and end up getting mapped to the <strong>values we use for depth-testing</strong> the fragment and ultimately <strong>writing into the depth buffer</strong>.</p>
<p>This non-linear z is useful for depth buffering, but not very intuitive for our purposes, which is why Unity includes macros and shader nodes that automatically decode it back to linear, world-space/eye-space depth for our convenience.</p>
</blockquote>
<h3 id="tex2Dproj"><a href="#tex2Dproj" class="headerlink" title="tex2Dproj"></a>tex2Dproj</h3><blockquote>
<p>The two functions are nearly identical. The only difference is that <code>tex2Dproj</code> will divide the input UV’s <code>xy</code> coordinates by its <code>w</code> coordinate before sampling the texture. This is to transform the coordinate from an orthographic to a perspective projection.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float existingDepth01 &#x3D; tex2D(_CameraDepthTexture, UNITY_PROJ_COORD(i.screenPosition.xy &#x2F; i.screenPosition.w)).r;</span><br></pre></td></tr></table></figure>

<p>和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">float existingDepth01 &#x3D; tex2D(_CameraDepthTexture, UNITY_PROJ_COORD(i.screenPosition.xy)).r;</span><br></pre></td></tr></table></figure>

<p>相等</p>
<h1 id="水波shader"><a href="#水波shader" class="headerlink" title="水波shader"></a>水波shader</h1><p>ripple的核心就是利用一个新的camera来生成一个renderTexture，用来提取粒子效果的信息，用来在水的表面实现水的shader效果。</p>
<p>这是因为单纯的shader貌似不能够让多个水波共存，所以只能采用这种方法。</p>
<p>首先设置好particle system</p>
<p>然后<strong>创建一个新的相机</strong>，设置为orthographic，并且<strong>Clear Flags</strong> to Solid Color，<strong>Background</strong> to Black 0 Alpha。将其target texture输出到一个自定义的renderTexture</p>
<p>之后让该相机只render  ripple layer，同时main camera不render ripple layer。</p>
<p>最后给rippleCam添加以下脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Camera cm;</span><br><span class="line">[SerializeField]</span><br><span class="line">RenderTexture rt;</span><br><span class="line">[SerializeField]</span><br><span class="line">Transform target;</span><br><span class="line">private void Awake()</span><br><span class="line">&#123;</span><br><span class="line">    cm &#x3D; GetComponent&lt;Camera&gt;();</span><br><span class="line">   </span><br><span class="line">    Shader.SetGlobalTexture(&quot;_GlobalEffectRT&quot;, rt);</span><br><span class="line">    Shader.SetGlobalFloat(&quot;_OrthographicCamSize&quot;,cm.orthographicSize);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; Start is called before the first frame update</span><br><span class="line">void Start()</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Update is called once per frame</span><br><span class="line">void Update()</span><br><span class="line">&#123;</span><br><span class="line">    transform.position &#x3D; new Vector3(target.position.x, transform.position.y, target.position.z);</span><br><span class="line">    Shader.SetGlobalVector(&quot;_Position&quot;, transform.position);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>主要功能就是让相机跟随人物，并且设置了两个shader的参数。</p>
<h3 id="shader内的操作解释"><a href="#shader内的操作解释" class="headerlink" title="shader内的操作解释"></a>shader内的操作解释</h3><p>在shader内的操作主要是</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">float2 uv = i.worldPos.xz - _Position.xz;</span><br><span class="line"><span class="comment">//orthographic size是相机的width的一半，所以这里的orthographic size要乘以2。</span></span><br><span class="line"><span class="comment">//uv除以这个值就是将位置差信息转化成（-0.5,0.5）区间内的数值。</span></span><br><span class="line">uv = uv / (_OrthographicCamSize * <span class="number">2</span>);</span><br><span class="line"><span class="comment">//+=0.5就是将该区间转化成（0,1）。</span></span><br><span class="line">uv += <span class="number">0.5</span>;</span><br><span class="line"><span class="keyword">float</span> ripples = tex2D(_GlobalEffectRT, uv).b;</span><br><span class="line"><span class="comment">//卡通化</span></span><br><span class="line">ripples = <span class="built_in">step</span>(<span class="number">0.99</span>, ripples * <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>world position就是每处渲染点在world space中的位置。</p>
<p>orthographic size是相机的width的一半，所以这里的orthographic size要乘以2。</p>
<p>此外，这里的orthographic size其实是决定了效果的<strong>作用范围</strong></p>
<p>uv除以这个值就是将位置差信息转化成（-0.5,0.5）区间内的数值。</p>
<p>+=0.5就是将该区间转化成（0,1）。</p>
<p>这样子就讲renderTexture的内容表示在水面shader的uv坐标上了，就可以进行tex2D了。</p>
<p>之后进行卡通画即可。这里*3是为了让判断精度更高</p>
<h1 id="Water-Shader完整代码"><a href="#Water-Shader完整代码" class="headerlink" title="Water Shader完整代码"></a>Water Shader完整代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">"Roystan/Toon/Water"</span></span><br><span class="line">&#123;</span><br><span class="line">	Properties</span><br><span class="line">	&#123;</span><br><span class="line">		_DepthGradientShallow(<span class="string">"Depth Gradient Shallow"</span>, Color) = (<span class="number">0.325</span>, <span class="number">0.807</span>, <span class="number">0.971</span>, <span class="number">0.725</span>)</span><br><span class="line">		_DepthGradientDeep(<span class="string">"Depth Gradient Deep"</span>, Color) = (<span class="number">0.086</span>, <span class="number">0.407</span>, <span class="number">1</span>, <span class="number">0.749</span>)</span><br><span class="line">		_DepthMaxDistance(<span class="string">"Depth Maximum Distance"</span>, Float) = <span class="number">1</span></span><br><span class="line">		_SurfaceNoise(<span class="string">"Surface Noise"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125;</span><br><span class="line">		_SurfaceNoiseCutoff(<span class="string">"Surface Noise Cutoff"</span>, Range(<span class="number">0</span>, <span class="number">1</span>)) = <span class="number">0.777</span></span><br><span class="line">		_SurfaceNoiseScroll(<span class="string">"Surface Noise Scroll Amount"</span>, Vector) = (<span class="number">0.03</span>, <span class="number">0.03</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">		_FoamDistance(<span class="string">"Foam Distance"</span>, Float) = <span class="number">0.4</span></span><br><span class="line">		<span class="comment">// Two channel distortion texture.</span></span><br><span class="line">		_SurfaceDistortion(<span class="string">"Surface Distortion"</span>, <span class="number">2</span>D) = <span class="string">"white"</span> &#123;&#125;</span><br><span class="line">		<span class="comment">// Control to multiply the strength of the distortion.</span></span><br><span class="line">		_SurfaceDistortionAmount(<span class="string">"Surface Distortion Amount"</span>, Range(<span class="number">0</span>, <span class="number">1</span>)) = <span class="number">0.27</span></span><br><span class="line">		_FoamMaxDistance(<span class="string">"Foam Maximum Distance"</span>, Float) = <span class="number">0.4</span></span><br><span class="line">		_FoamMinDistance(<span class="string">"Foam Minimum Distance"</span>, Float) = <span class="number">0.04</span></span><br><span class="line">	&#125;</span><br><span class="line">	SubShader</span><br><span class="line">	&#123;</span><br><span class="line">		Tags</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">"RenderType"</span> = <span class="string">"Opaque"</span></span><br><span class="line">			<span class="string">"Queue"</span> = <span class="string">"Transparent"</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Pass</span><br><span class="line">		&#123;</span><br><span class="line">			Blend SrcAlpha OneMinusSrcAlpha</span><br><span class="line">			ZWrite Off</span><br><span class="line">			CGPROGRAM</span><br><span class="line">			#define SMOOTHSTEP_AA <span class="number">0.01</span></span><br><span class="line">			#pragma vertex vert</span><br><span class="line">			#pragma fragment frag</span><br><span class="line"></span><br><span class="line">			#include <span class="string">"UnityCG.cginc"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			float4 _DepthGradientShallow;</span><br><span class="line">			float4 _DepthGradientDeep;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">float</span> _DepthMaxDistance;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">float</span> _SurfaceNoiseCutoff;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">float</span> _FoamDistance;</span><br><span class="line"></span><br><span class="line">			float2 _SurfaceNoiseScroll;</span><br><span class="line"></span><br><span class="line">			sampler2D _CameraDepthTexture;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">			<span class="comment">// Matching variables.</span></span><br><span class="line">			sampler2D _SurfaceDistortion;</span><br><span class="line">			float4 _SurfaceDistortion_ST;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">float</span> _SurfaceDistortionAmount;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">float</span> _FoamMaxDistance;</span><br><span class="line">			<span class="keyword">float</span> _FoamMinDistance;</span><br><span class="line"></span><br><span class="line">			sampler2D _GlobalEffectRT;</span><br><span class="line">			<span class="keyword">float</span> _OrthographicCamSize;</span><br><span class="line">			float3 _Position;</span><br><span class="line"></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> <span class="title">appdata</span></span></span><br><span class="line"><span class="class">			&#123;</span></span><br><span class="line">				float4 vertex : POSITION;</span><br><span class="line">				float4 uv : TEXCOORD0;</span><br><span class="line">				float3 normal : NORMAL;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> <span class="title">v2f</span></span></span><br><span class="line"><span class="class">			&#123;</span></span><br><span class="line">				float4 vertex : SV_POSITION;</span><br><span class="line">				float4 screenPosition : TEXCOORD2;</span><br><span class="line">				float2 noiseUV : TEXCOORD0;</span><br><span class="line">				float2 distortUV : TEXCOORD1;</span><br><span class="line">				float3 viewNormal : NORMAL;</span><br><span class="line">				float4 worldPos : TEXCOORD4;</span><br><span class="line">			&#125;;</span><br><span class="line"></span><br><span class="line">			sampler2D _SurfaceNoise;</span><br><span class="line">			float4 _SurfaceNoise_ST;</span><br><span class="line">			sampler2D _CameraNormalsTexture;</span><br><span class="line"></span><br><span class="line">			<span class="function">v2f <span class="title">vert</span><span class="params">(appdata v)</span></span></span><br><span class="line"><span class="function">			</span>&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				o.screenPosition = ComputeScreenPos(o.vertex);</span><br><span class="line">				o.noiseUV = TRANSFORM_TEX(v.uv, _SurfaceNoise);</span><br><span class="line">				o.distortUV = TRANSFORM_TEX(v.uv, _SurfaceDistortion);</span><br><span class="line">				o.viewNormal = COMPUTE_VIEW_NORMAL;</span><br><span class="line">				o.worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">return</span> o;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="function">float4 <span class="title">frag</span><span class="params">(v2f i)</span> : SV_Target</span></span><br><span class="line"><span class="function">			</span>&#123;</span><br><span class="line">				float2 uv = i.worldPos.xz - _Position.xz;</span><br><span class="line">				uv = uv / (_OrthographicCamSize * <span class="number">2</span>);</span><br><span class="line">				uv += <span class="number">0.5</span>;</span><br><span class="line">				<span class="keyword">float</span> ripples = tex2D(_GlobalEffectRT, uv).b;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">float</span> existingDepth01 = tex2Dproj(_CameraDepthTexture, UNITY_PROJ_COORD(i.screenPosition)).r;</span><br><span class="line">				<span class="comment">//change from non-linear to linear</span></span><br><span class="line">				<span class="keyword">float</span> existingDepthLinear = LinearEyeDepth(existingDepth01);</span><br><span class="line">				<span class="comment">//computer difference</span></span><br><span class="line">				<span class="keyword">float</span> depthDifference = existingDepthLinear - i.screenPosition.w;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">float</span> waterDepthDifference01 = saturate(depthDifference / _DepthMaxDistance);</span><br><span class="line">				float4 waterColor = lerp(_DepthGradientShallow, _DepthGradientDeep, waterDepthDifference01);</span><br><span class="line"></span><br><span class="line">				<span class="comment">//用来扭曲noise texture的uv值</span></span><br><span class="line">				float2 distortSample = (tex2D(_SurfaceDistortion, i.distortUV).xy * <span class="number">2</span> - <span class="number">1</span>) * _SurfaceDistortionAmount;</span><br><span class="line"></span><br><span class="line">				float2 noiseUV = float2((i.noiseUV.x + _Time.y * _SurfaceNoiseScroll.x) + distortSample.x, (i.noiseUV.y + _Time.y * _SurfaceNoiseScroll.y) + distortSample.y);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">float</span> surfaceNoiseSample = tex2D(_SurfaceNoise, noiseUV).r;</span><br><span class="line"></span><br><span class="line">				float3 existingNormal = tex2Dproj(_CameraNormalsTexture, UNITY_PROJ_COORD(i.screenPosition));</span><br><span class="line">				float3 normalDot = saturate(dot(existingNormal, i.viewNormal));</span><br><span class="line">				<span class="keyword">float</span> foamDistance = lerp(_FoamMaxDistance, _FoamMinDistance, normalDot);</span><br><span class="line">				<span class="keyword">float</span> foamDepthDifference01 = saturate(depthDifference / foamDistance);</span><br><span class="line">				<span class="comment">//float foamDepthDifference01 = saturate(depthDifference / _FoamDistance);</span></span><br><span class="line">				<span class="keyword">float</span> surfaceNoiseCutoff = foamDepthDifference01 * _SurfaceNoiseCutoff;</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">float</span> surfaceNoise = smoothstep(surfaceNoiseCutoff - SMOOTHSTEP_AA, surfaceNoiseCutoff + SMOOTHSTEP_AA, surfaceNoiseSample);</span><br><span class="line">				<span class="comment">//float surfaceNoise = surfaceNoiseSample &gt; surfaceNoiseCutoff ? 1 : 0;</span></span><br><span class="line"></span><br><span class="line">				ripples = <span class="built_in">step</span>(<span class="number">0.99</span>, ripples * <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">				<span class="comment">//return waterColor + surfaceNoise;</span></span><br><span class="line">				<span class="keyword">return</span> waterColor + surfaceNoise + ripples;</span><br><span class="line">			&#125;</span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/computer-graphics/" rel="tag"># computer graphics</a>
              <a href="/tags/unity/" rel="tag"># unity</a>
              <a href="/tags/shader/" rel="tag"># shader</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/virtualbox%E7%B2%98%E8%B4%B4%E6%9D%BF%E5%85%B1%E4%BA%AB%E4%B8%8D%E7%94%9F%E6%95%88/" rel="prev" title="virtualbox粘贴板共享不生效">
      <i class="fa fa-chevron-left"></i> virtualbox粘贴板共享不生效
    </a></div>
      <div class="post-nav-item">
    <a href="/geometryGrassShader/" rel="next" title="geometryGrassShader">
      geometryGrassShader <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#参考资料"><span class="nav-number">1.</span> <span class="nav-text">参考资料</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#水面shader"><span class="nav-number">2.</span> <span class="nav-text">水面shader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cameraDepthTexture的解释"><span class="nav-number">2.0.1.</span> <span class="nav-text">cameraDepthTexture的解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SceneDepth（CameraDepthTexture）的解释"><span class="nav-number">2.0.2.</span> <span class="nav-text">SceneDepth（CameraDepthTexture）的解释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#screenPosition-w的解释"><span class="nav-number">2.0.3.</span> <span class="nav-text">screenPosition.w的解释</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#解释一："><span class="nav-number">2.0.3.0.1.</span> <span class="nav-text">解释一：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#解释二："><span class="nav-number">2.0.3.0.2.</span> <span class="nav-text">解释二：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#解释三："><span class="nav-number">2.0.3.0.3.</span> <span class="nav-text">解释三：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tex2Dproj"><span class="nav-number">2.0.4.</span> <span class="nav-text">tex2Dproj</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#水波shader"><span class="nav-number">3.</span> <span class="nav-text">水波shader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#shader内的操作解释"><span class="nav-number">3.0.1.</span> <span class="nav-text">shader内的操作解释</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Water-Shader完整代码"><span class="nav-number">4.</span> <span class="nav-text">Water Shader完整代码</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="gzhao01"
      src="/images/smileMan.jpg">
  <p class="site-author-name" itemprop="name">gzhao01</p>
  <div class="site-description" itemprop="description">interested in coding, gaming and animation</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">106</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">21</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">62</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gzhao01" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gzhao01" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/6692208" title="Bilibili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;6692208" rel="noopener" target="_blank"><i class="custom icon-bilibili-line fa-fw"></i>Bilibili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/2909840cd97e" title="JianShu → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;2909840cd97e" rel="noopener" target="_blank"><i class="custom icon-jianshu fa-fw"></i>JianShu</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">gzhao01</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">184k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">2:48</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script color='0.0.0' opacity='0.5' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest-nomobile.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'ATOAcHehJMfiS6nVHoBbCisu-gzGzoHsz',
      appKey     : 'K0ve0Ydk6XMKpm49l7T5BPD5',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

    </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>

	<!-- ͼƬ�ֲ�js�ļ�cdn -->
	<script src="https://cdn.bootcdn.net/ajax/libs/jquery-backstretch/2.1.18/jquery.backstretch.min.js"></script>

	<!-- �Զ����js�ļ� -->
	<script>
	$("body").backstretch([
	  "/images/background_1.jpg",
	  "/images/background_2.jpg"
	  ], { duration: 60000, fade: 1500 });
	</script>

</html>
